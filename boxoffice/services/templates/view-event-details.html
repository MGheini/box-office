{% extends "layout.html" %}

{% block title %}
{{ event.event_title }}
{% endblock %}

{% load staticfiles %}

{% block style %}
<link rel="stylesheet" href="{% static "styles/pcustom.css" %}" />
<style type="text/css">
.row-event {
  background-color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="panel panel-default">

<div class="panel-heading" style="padding-top: 0; padding-bottom: 0">
  <div class="row-event">
    <div class="col-md-12">
      <h3 style="margin-bottom: 0"> {{ event.event_title }} <small> <span class="glyphicon glyphicon-star"> </span>
        <span class="glyphicon glyphicon-star"></span>
        <span class="glyphicon glyphicon-star"></span>
        <span class="glyphicon glyphicon-star"></span>
        <span class="glyphicon glyphicon-star-empty"></span></small>
      </h3>
    </div>
  </div>

  <div class="row-event">
    <div class="col-md-12" style="height: 50px;">
      <h4 style="margin-top: 10px; margin-bottom: 10px">
        <ul class="breadcrumb" style="margin-top: 10;"  style="padding-top: 0">
          <li class="active"><a href="/{{ event.event_category.category_name }}/">{{ event.event_category.category_name }}</a></li>
          <li class="active"><a href="/{{ event.event_category.category_name }}/{{ event.event_subcategory.subcategory_name }}/">{{ event.event_subcategory.subcategory_name }}</a></li>
        </ul>
      </h4>
    </div>
  </div>
</div>

<div class="panel-body">
  <div class="col-md-4 text-center center-block">
    <img src="{{ event.event_image.url }}" class="img img-responsive center-block img-thumbnail" id="eventImage" style="width: 200px; height: 250px; padding: 10px" />
    <div class="col-md-12">
          <!-- <h4></h4> -->
          <form role="form" method="GET">
            <div style="margin: 5px" class="row-event lead center-block">
              <h5><span style="margin: 20px">امتیاز دهید:</span><div id="stars" class="starrr"></div><h5>
                <!-- You gave a rating of <span id="count">0</span> star(s) -->
              </div>
            </form>
          </div>
  </div>

  <div class="col-md-8">
    <div class="row-event">
      <div class="col-md-12">
        <h4 style="margin-bottom: 20px"><strong>محل برگزاری رویداد: </strong> <span id="occurPlace"> برج میلاد تهران </span></h4>
        <h4 style="margin-bottom: 20px"><strong>زمان برگزاری رویداد: </strong> <span id="occurTime"> ۲۱ آبان ۱۳۹۴ ساعت ۱۸:۳۰ </span></h4>
        <h4 style="margin-bottom: 20px"><strong>آخرین مهلت خرید بلیت: </strong> <span id="lastTimeToBuy"> ۲۰ آبان ۱۳۹۴ ساعت ۲۳:۵۵ </span></h4>
          <h5>
            <table class="table table-striped table-bordered table-hover table-condensed table-responsive">
              <thead>
                <tr>
                  <th>نوع بلیت</th>
                  <th>قیمت</th>
                  <th>ظرفیت</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>بلیت ارزون</td>
                  <td>۳۰۰۰۰ تومان</td>
                  <td>۱۲ نفر</td>
                </tr>

                <tr>
                  <td>بلیت گرون</td>
                  <td>۶۰۰۰۰ تومان</td>
                  <td>۲۰ نفر</td>
                </tr>
              </tbody>

            </table>
          </h5>

        </div>
      </div>

      <div class="row-event">
        <div class="col-md-10 col-md-offset-1">
          <a href="/events/1/purchase/" class="btn btn-success btn-lg btn-block">می‌خواهم بخرم!</a>
        </div>
      </div>
    </div>
      
    <hr />
    <div class="row-event">
      <div class="col-md-8 col-md-offset-2 text-center">
        <div class="panel panel-default">
          <div class="panel-body">
            <h4 style="margin-top: 0">توضیحات تکمیلی</h4>
            <p>
              در این جا یک سری توضیح تکمیلی مینوتیسیم که چیزایی است که برگزارکنده‌ی رویداد قبلا موقعی که می‌خواسته رویداد را ثبت کنه وارد کرده.
              حواسمان باشد که اگر کللن اینجا خالی بود، نگذاریمش
            </p>
          </div>
        </div>
      </div>
    </div>


    <hr />
    <div class="row-event">
      <div class="col-md-12">
        <div class="panel panel-default" style="border: none">
          <div class="panel-body" style="padding-top: 0">
            <h3 style="margin: 0">نظرات کاربران</h3>
            <div>
              <ul class="comments-list">
                <!--Comments go here!-->

                <!-- start of each comment -->
                <li class="comment">
                  <div class="comment-body">
                    <div class="comment-heading">
                      <a><h4 class="user"> پردیس پاشاخانلو </h4></a>
                      <h5 class="time"> ارسال شده در ۲۵ آبان ۹۳ ساعت ۱۵:۳۰ </h5>
                    </div>
                    <p> این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. این جا کامنت من نوشته می‌شود. </p>
                  </div>
                </li>
                <hr />
                <!-- end of each comment -->

              </ul>
            </div>
            <form method="GET" action="/events/{{ event.id }}/comment/">
              <div class="input-group">
                <input type="text" id="comment-text" class="form-control" placeholder="نظر شما چیست؟" style="padding: 10px" />
                <span class="input-group-btn"><button type="submit" class="add-comment btn btn-default" data-id="{{ event.id }}"><span class="glyphicon glyphicon-comment"></span></button></span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    </div> <!-- end of panel-body -->
    {% endblock %}

    {% block script %}
    <script type="text/javascript" src="{% static "scripts/star-rating.js" %}"></script>
    <script type="text/javascript">
      buttons = document.getElementsByClassName("add-comment");
      for(var i = 0; i < buttons.length; i++) {
        buttons[i].addEventListener('click', function(event) {
          event.preventDefault();

          var comment_text = document.getElementById("comment-text").value;
          var event_id = {{ event.id }};

          var xhr = new XMLHttpRequest();
          var make_url = '/events/' + event_id + '/comment/?comment_text=' + comment_text;
          alert(make_url);
          xhr.open('get', make_url);
          xhr.send(null);

          xhr.onreadystatechange = function() {
                if(xhr.readyState === 4) {
                    if(xhr.status === 200) {
                        if (!(comment_text === "")) {
                            document.getElementById("comment-text").value = "";
                            var newComment = document.createElement("li");
                            newComment.setAttribute("class", "comment");
                            newComment.innerHTML = '<div class="comment-body"><div class="comment-heading"><a><h4 class="user">'
                            + {{ member.user.username }}
                            + '</h4></a><h5 class="time"> '
                            + 'ارسال شده در '
                            + 'اندکی پیش '
                            + ' </h5></div><p>'
                            + comment_text
                            +'</p></div><hr />';

                            document.querySelector(".comments-list").appendChild(newComment);
                            //cm_num = parseInt(document.querySelector("#p" + post_id + " .cm-num").innerHTML)
                            //document.querySelector("#p" + post_id + " .cm-num").innerHTML = cm_num + 1
                            document.getElementById("comment-text").value = "";
                        }
                    }
                    else {
                        // alert('ERROR!');
                    }
                }
            };
        });
      }
    </script>
    {% endblock %}